<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--    Form View    -->
        <!--
        Inheriting the partner form view in order to:
            1- Add the two new boolean fields: is_customer & is_supplier under the partner name.
            2- Add the partner_code field before the partner name.
            3- The following fields/groups are useless for no customer partner then we make them invisible and
            not required when is_customer field is unchecked: sale group, property_account_receivable_id field.
            4- The following fields/groups are useless for no supplier partner then we make them invisible and
            not required when is_supplier field is unchecked: purchase group, property_account_payable_id field.
            5- Add two smart buttons: Customer Clearance & Supplier Clearance
        -->
        <record id="smartest_view_partner_form_inherit" model="ir.ui.view">
            <field name="name">smartest.view.partner.form.inherit</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='purchase']" position="inside">
                    <field name="is_supplier" invisible="1"/>
                </xpath>
                <xpath expr="//group[@name='sale']" position="inside">
                    <field name="is_customer" invisible="1"/>
                </xpath>
                <xpath expr="//group[@name='purchase']" position="attributes">
                    <attribute name="attrs">{'invisible' : [('is_supplier', '=', False)]}</attribute>
                </xpath>
                <xpath expr="//group[@name='sale']" position="attributes">
                    <attribute name="attrs">{'invisible' : [('is_customer', '=', False)]}</attribute>
                </xpath>
                <xpath expr="//page[@name='accounting']//group//group[@name='accounting_entries']//field[@name='property_account_receivable_id']" position="before">
                    <field name="partner_account_group_id" options="{'no_create': 1, 'no_edit': 1}"
                           attrs="{'invisible' : [('is_supplier', '=', False), ('is_customer', '=', False)], 'required' : ['|',('is_supplier', '=', True), ('is_customer', '=', True)]}"/>
                </xpath>
                <xpath expr="//page[@name='accounting']//group//group[@name='accounting_entries']//field[@name='property_account_receivable_id']" position="after">
                    <field name="affected_partner" invisible="1"/>
                </xpath>
                <xpath expr="//page[@name='accounting']//group//group[@name='accounting_entries']//field[@name='property_account_receivable_id']" position="attributes">
                    <attribute name="attrs">{'invisible' : [('is_customer', '=', False)], 'required' : [('is_customer', '=', True)]}</attribute>
                    <attribute name="readonly">1</attribute>
                    <attribute name="force_save">1</attribute>
                </xpath>
                <xpath expr="//page[@name='accounting']//group//group[@name='accounting_entries']//field[@name='property_account_payable_id']" position="attributes">
                    <attribute name="attrs">{'invisible' : [('is_supplier', '=', False)], 'required' : [('is_supplier', '=', True)]}</attribute>
                    <attribute name="readonly">1</attribute>
                    <attribute name="force_save">1</attribute>
                </xpath>
                <div name="button_box" position="inside">
                    <button type="object" class="oe_stat_button" icon="fa-usd" name="action_view_payment"
                            attrs="{'invisible' : [('is_customer', '=', False)]}" context="{'default_partner_id': active_id}">
                        <div class="o_form_field o_stat_info">
                            <span class="o_stat_value">
                                <field name="customer_clearance" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            </span>
                            <span class="o_stat_text">Customer Clearance</span>
                        </div>
                    </button>
                </div>
                <div name="button_box" position="inside">
                    <button type="object" class="oe_stat_button" icon="fa-usd" name="action_view_payment"
                            attrs="{'invisible' : [('is_supplier', '=', False)]}" context="{'default_partner_id': active_id}">
                        <div class="o_form_field o_stat_info">
                            <span class="o_stat_value">
                                <field name="supplier_clearance" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            </span>
                            <span class="o_stat_text">Supplier Clearance</span>
                        </div>
                    </button>
                </div>
            </field>
        </record>


        <!--    Tree View   -->
        <record id="smartest_view_partner_tree_inherit" model="ir.ui.view">
            <field name="name">smartest.view.partner.form.inherit</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='country_id']" position="after">
                    <field name="commercial_register"/>
                    <field name="fiscal_identification"/>
                    <field name="taxation"/>
                    <field name="nis"/>

                </xpath>


            </field>
        </record>


        <!--
        Inheriting the following action in order to:
            1- Add domain that force showing only suppliers partners when calling this action.
            2- Add default_is_supplier context attribute as True in order to make is_customer field checked when
            hitting create button from this action.
        -->
        <record id="account.res_partner_action_supplier" model="ir.actions.act_window">
            <field name="domain">[('is_supplier', '=', True)]</field>
            <field name="context">{'default_is_supplier': True}</field>
        </record>

        <!--
        Inheriting the following action in order to:
            1- Add domain that force showing only customer partners when calling this action.
            2- Add default_is_customer context attribute as True in order to make is_customer field checked when
            hitting create button from this action.
        -->
        <record id="account.res_partner_action_customer" model="ir.actions.act_window">
            <field name="domain">[('is_customer', '=', True)]</field>
            <field name="context">{'default_is_customer': True}</field>
        </record>
    </data>
</odoo>
