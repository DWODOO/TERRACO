<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_payslip_inherit" inherit_id="hr_payroll.report_payslip">

        <xpath expr="//t[@t-call='web.internal_layout']" position="attributes">

            <attribute name="t-call">l10n_dz_payroll.external_smartest_layout</attribute>


        </xpath>

        <xpath expr="//div" position="replace">
            <style>

            </style>
            <div style="background-color:rgba(128, 128, 128, 0.5686274509803921); width:100%;border-style: double; border: solid 1px black;height: 20px;">

            </div>
            <br/>
            <br/>
            <div class="row">
                <div style="width:55%;padding-left: 15px;">
                    <br/>
                    <br/>

                    <h3 style="text-align:center;text-decoration: underline;">BULLETIN DE PAIE</h3>
                    <br/>
                    <br/>
                    <table style="width: 400px;">
                        <tr>
                            <td>
                                <strong>Période du:</strong>
                            </td>
                            <td>
                                <span t-field="o.date_from"/> <strong>    Au: </strong> <span t-field="o.date_to"/>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <strong>Paiement le:</strong>
                            </td>
                            <td>
                                <span t-field="o.date_to"/>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <strong>Nr compte:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.bank_account_id.acc_number"/>

                            </td>

                        </tr>
                        <tr>
                            <td>
                                <strong>Mode de réglement:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.type_payment_id"/>
                            </td>

                        </tr>

                    </table>
                </div>
                <div style="padding:20px;border: solid 1px black;padding-right: 0px">

                    <table style="border-collapse:separate; border-spacing: 5px; width:350px;">
                        <tr>


                            <td>
                                <strong>
                                    <span>Matricule:</span>
                                </strong>
                            </td>

                            <td>
                                <span t-field="o.employee_id.registration_number"/>
                            </td>

                        </tr>
                        <tr>


                            <td>
                                <strong>
                                    <span>Nom:</span>
                                </strong>
                            </td>

                            <td>
                                <span t-field="o.employee_id"/>
                            </td>

                        </tr>
                        <tr>


                            <td>
                                <strong>Fonction:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.job_id"/>
                            </td>
                        </tr>
                        <tr>


                            <td>
                                <strong>Département:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.department_id"/>
                            </td>

                        </tr>
                        <tr>
                            <tr>


                                <td>
                                    <strong>Date d'entrée:</strong>
                                </td>
                                <td>
                                    <span t-field="o.contract_id.date_start"/>
                                </td>

                            </tr>


                            <td>
                                <strong>N° Sec.Soc:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.social_security_number"/>
                            </td>

                        </tr>
                        <tr>


                            <td>
                                <strong>Situ. Famille:</strong>
                            </td>
                            <td>
                                <span t-field="o.employee_id.marital"/>
                            </td>

                        </tr>

                    </table>
                </div>
            </div>

            <br/>
            <br/>
            <style>
                table.payroll { border: none;
                border-collapse: collapse;
                width:100%;
                border-bottom:solid 1px black;
                font-size: small;
                }
                table.payroll th { border-left: 1px solid black;
                border-right: 1px solid black;
                border-top: 1px solid black;
                background-color: rgba(128, 128, 128, 0.5686274509803921);
                text-align:center;
                }
                .espace{ /* last row */
                height:20px;
                }
                table.payroll td { border-left: 1px solid black;
                border-right: 1px solid black;
                padding:5px;
                padding-left:10px;


                }

            </style>

            <table class="payroll">
                <thead>
                    <tr style="text-align:center;">
                        <th rowspan="2">N°</th>
                        <th rowspan="2">Designation</th>
                        <th rowspan="2">Nombre</th>
                        <th rowspan="2">Base</th>
                        <th colspan="3">Part salariale</th>

                    </tr>
                    <tr>
                        <th>Taux</th>
                        <th>Gain</th>
                        <th>Retenue</th>
                    </tr>
                </thead>

                <tbody>
                    <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and line.sequence &lt; 369 )"
                        t-as="line">
                        <td>
                            <span t-field="line.code"/>
                        </td>
                        <td>
                            <span t-field="line.name"/>
                        </td>
                        <td>
                            <span t-field="line.quantity"/>
                        </td>


                        <td>
                             <span t-esc="'{:,.2f}'.format(line.amount)"/>
                        </td>
                        <td>
                            <t t-if="line.amount_percentage >0">
                                <t t-if="line.amount_percentage &lt;= 100">
                                    <span t-field="line.amount_percentage"/>
                                </t>
                            </t>
                        </td>

                        <td>
                            <t t-if="line.total >= 0">
                                <span t-esc="'{:,.2f}'.format(line.total)"/>
                            </t>
                        </td>


                        <td>
                            <t t-if="line.total &lt;= 0">
                                <span t-esc="'{:,.2f}'.format(line.total)"/>
                            </t>
                        </td>


                    </tr>

                    <tr>
                        <td></td>
                        <td style="text-align:center;">
                          Total Brut
                        </td>

                        <td></td>
                        <td></td>
                        <td></td>
                        <td>
                            <span t-esc="'{:,.2f}'.format(sum(line.total for line in o.line_ids.filtered(lambda x: x.sequence == 369)))"/>
                        </td>
                        <td></td>
                    </tr>

                    <tr t-foreach="o.line_ids.filtered(lambda line:  line.sequence > 400 and line.sequence &lt;= 403)" t-as="line">

                        <td>
                            <span t-field="line.code"/>
                        </td>
                        <td>
                            <span t-field="line.name"/>
                        </td>
                        <td>
                            <span t-field="line.quantity"/>
                        </td>

                        <td>
                           <span t-esc="'{:,.2f}'.format(line.amount)"/>
                        </td>
                        <td>
                            <t t-if="line.amount_percentage >0">
                                <t t-if="line.amount_percentage &lt;= 100">
                                    <span t-field="line.amount_percentage"/>
                                </t>
                            </t>
                        </td>
                        <td>

                        </td>


                        <td>

                            <span t-esc="'{:,.2f}'.format(line.total)"/>

                        </td>
                    </tr>
                     <tr t-foreach="o.line_ids.filtered(lambda line:  line.sequence >= 407 and line.sequence &lt;= 409)" t-as="line">

                        <td>
                            <span t-field="line.code"/>
                        </td>
                        <td>
                            <span t-field="line.name"/>
                        </td>
                        <td>
                            <span t-field="line.quantity"/>
                        </td>

                        <td>
                           <span t-esc="'{:,.2f}'.format(line.amount)"/>
                        </td>
                        <td>
                            <t t-if="line.amount_percentage >0">
                                <t t-if="line.amount_percentage &lt;= 100">
                                    <span t-field="line.amount_percentage"/>
                                </t>
                            </t>
                        </td>
                        <td>

                        </td>


                        <td>

                            <span t-esc="'{:,.2f}'.format(line.total)"/>

                        </td>
                    </tr>

                    <tr >


                        <td>
                        </td>

                        <td style="text-align:center;">
                            Total Cotisation
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>

                        <td>
                            <span t-esc="'{:,.2f}'.format(sum(line.total for line in o.line_ids.filtered(lambda x: x.sequence in [401,402,403,407,408,409])))"/>
                        </td>

                    </tr>

                    <tr t-foreach="o.line_ids.filtered(lambda line: line.sequence > 409 and line.sequence &lt;= 899 )"
                        t-as="line">

                        <td>
                            <span t-field="line.code"/>
                        </td>
                        <td>
                            <span t-field="line.name"/>
                        </td>
                        <td>
                            <span t-field="line.quantity"/>
                        </td>

                        <td>
                          <span t-esc="'{:,.2f}'.format(line.amount)"/>
                        </td>
                        <td>
                            <t t-if="line.amount_percentage >0">
                                <t t-if="line.amount_percentage &lt;= 100">
                                    <span t-field="line.amount_percentage"/>
                                </t>
                            </t>
                        </td>
                        <td>
                            <t t-if="line.total >= 0">
                                <span t-esc="'{:,.2f}'.format(line.total)"/>
                            </t>
                        </td>


                        <td>
                            <t t-if="line.total &lt;= 0">
                                <span t-esc="'{:,.2f}'.format(line.total)"/>
                            </t>
                        </td>
                    </tr>
                    <tr class="espace">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                </tbody>
            </table>
            <br/>
            <br/>
            <br/>
            <table style="width:100%;border:solid black 1px;">
                <tr >

                    <td style="text-align: right; width:85%;border-right:solid black 1px;background-color:rgba(128, 128, 128, 0.5686274509803921);">
                        <strong>NET A PAYER:</strong>
                    </td>
                    <td style="text-align:center;">
                        <strong>

                            <span t-esc="'{:,.2f}'.format(sum(line.total for line in o.line_ids.filtered(lambda x: x.sequence == 999)))"/>
                        </strong>


                    </td>
                </tr>


            </table>
        </xpath>


    </template>
</odoo>
