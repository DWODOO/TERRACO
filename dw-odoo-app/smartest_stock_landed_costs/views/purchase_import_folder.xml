<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="view_purchase_import_folder_tree" model="ir.ui.view">
        <field name="name">purchase.import.folder.tree</field>
        <field name="model">purchase.import.folder</field>
        <field name="arch" type="xml">
            <tree decoration-info="state in ('draft','ongoing')" decoration-muted="state in ('cancel')" string="Purchase Import Folder">
                <field name="name"/>
                <field name="date"/>
                <field name="company_id"/>
                <field name="state" widget="badge" decoration-success="state == 'done'" decoration-warning="state == 'cancel'" decoration-info="state == 'draft' or state == 'ongoing'"/>
            </tree>
        </field>
    </record>

    <record id="view_purchase_import_folder_form" model="ir.ui.view">
        <field name="name">purchase.import.folder.form</field>
        <field name="model">purchase.import.folder</field>
        <field name="arch" type="xml">
            <form string="Product Request">
                <header>
                    <button name="button_done" states="draft,ongoing" string="Validate" type="object" class="oe_highlight"/>
                    <button name="button_draft" states="ongoing" string="Reset" type="object"/>
<!--                    <button name="action_create_purchase_order" states="ongoing" string="CreÃ© une Demande de prix" type="object"-->
<!--                            context="{}"/>-->
                    <field name="state" widget="statusbar" statusbar_visible="draft,ongoing,done"
                            statusbar_colors='{"done":"blue"}'/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_import_file" type="object" class="oe_stat_button" icon="fa-files-o" attrs="{'invisible': [('state','in', ['draft','cancel'])]}">
                            LC
                        </button>
                    </div>
                    <div class="oe_edit_only">
                        <label for="name" class="oe_inline" attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                    </div>
                    <h1>
                        <field name="name" class="oe_inline" attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                    </h1>
                    <group col="6">
                        <field name="date" attrs="{'readonly': [('state','!=', 'draft')]}"/>
                        <field name="company_id" groups="base.group_multi_company" widget="selection" attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                    </group>
                    <group>
                        <field name="purchase_order_ids"  attrs="{'readonly': [('state','in', ['done','cancel'])]}"  widget="many2many_tags"/>
                        <field name="purchase_picking_ids" widget="many2many_tags"/>
                    </group>
                    <group>
                        <field name="comex_import_file_ids" widget="many2many_tags"/>
                        <field name="description" attrs="{'readonly': [('state','!=', 'draft')]}"/>
                    </group>
                    <notebook>
                        <page string="Vendor Invoice">
                            <field name="vendor_line_ids">
                                <tree editable="bottom">
                                    <field name="invoice_id"/>
                                    <field name="vendor_invoice" invisible="1"/>
                                    <field name="purchase_order_id" invisible="1"/>
                                    <field name="vendor_invoice" invisible="1"/>
                                    <field name="amount_total" widget="monetary" sum="Total" optional="hide">
                                        <field name="invoice_currency"/>
                                    </field>                                    <field name="invoice_state" widget="badge" decoration-success="invoice_state == 'posted'" decoration-warning="invoice_state == 'cancel'" decoration-info="invoice_state == 'draft'"/>
                                    <field name="payment_state" widget="badge" decoration-success="payment_state == 'paid' or payment_state == 'in_payment'" decoration-warning="payment_state == 'not_paid' or payment_state == 'partial'" decoration-info="payment_state == 'reversed'"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Fees Invoice">
                            <field name="fees_line_ids">
                                <tree editable="bottom">
                                    <field name="invoice_id"/>
                                    <field name="vendor_invoice" invisible="1"/>
                                    <field name="purchase_order_id" invisible="1"/>
                                    <field name="vendor_invoice" invisible="1"/>
                                    <field name="amount_total" widget="monetary" sum="Total" optional="hide">
                                        <field name="invoice_currency"/>
                                    </field>
                                    <field name="invoice_state" widget="badge" decoration-success="invoice_state == 'posted'" decoration-warning="invoice_state == 'cancel'" decoration-info="invoice_state == 'draft'"/>
                                    <field name="payment_state" widget="badge" decoration-success="payment_state == 'paid' or payment_state == 'in_payment'" decoration-warning="payment_state == 'not_paid' or payment_state == 'partial'" decoration-info="payment_state == 'reversed'"/>
                                    <field name="landed_cost_visible" invisible="1"/>
                                    <field name="landed_costs_ids" widget="many2many_tags"/>
                                    <button string="Add Landed Costs" type="object" name="button_create_landed_cost" icon="fa-plus" class="oe_highlight" attrs="{'invisible': [('landed_cost_visible', '!=', True)]}"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_purchase_import_folder_search" model="ir.ui.view">
        <field name="name">purchase.import.folder.search</field>
        <field name="model">purchase.import.folder</field>
        <field name="arch" type="xml">
            <search string="Search Purchase Folder">
                <field name="name" string="Purchase Folder"/>
                <separator/>
                <field name="state"/>
                <filter name="state_draft" string="Draft" domain="[('state','=','draft')]" help="Folder is draft"/>
                <filter name="state_ongoing" string="Ongoing" domain="[('state','=','ongoing')]" help="Folder is open"/>
                <filter name="state_done" string="Done" domain="[('state','=','done')]" help="Folder is Validated"/>
                <filter name="state_cancel" string="Rejected" domain="[('state','=','cancel')]" help="Folder is rejected"/>
                <group expand="0" string="Group By...">
                    <filter name="date" string="Date" icon="fa-calendar" domain="[]" context="{'group_by':'date'}"/>
                </group>
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_purchase_import_folder">
        <field name="name">Purchase Import Folder</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.import.folder</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
<!--        <field name="search_view_id" ref="view_purchase_product_request_search"/>-->
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to start a new purchase Import Folder.
            </p>
            <p>
                A purchase import folder is a folder that contains all data related to an import purchase.
            </p>
        </field>
    </record>

    <menuitem
                id="parent_menu_purchase_import_folder"
                name="Import Folder"
                parent="purchase.menu_purchase_root"
                sequence="20"
                action="action_purchase_import_folder"
        />
</odoo>