<?xml version="1.0" ?>
<odoo>
    <!--
        Inherit hr.appraisal core view
    -->
    <record model="ir.ui.view" id="smartest_view_hr_appraisal_form_inherit">
        <field name="name">smartest.hr.appraisal.form.inherit</field>
        <field name="model">hr.appraisal</field>
        <field name="inherit_id" ref="hr_appraisal.view_hr_appraisal_form"/>
        <field name="arch" type="xml">

            <button name="action_done" position="attributes">
                <attribute name="class">oe_highlight</attribute>
            </button>

            <button name="action_done" position="after">
                <field name="user_can_unlock" invisible="1"/>
                <button name="button_unlock"
                        string="Unlock"
                        states="done"
                        type="object"
                        attrs="{'invisible': [('user_can_unlock', '=', False)]}"
                        groups="hr_appraisal.group_hr_appraisal_user"/>
            </button>
            <xpath expr="//field[@name='manager_ids']" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>
            </xpath>
<!--            <xpath expr="//field[@name='collaborators_ids']" position="attributes">-->
<!--                <attribute name="groups">base.group_no_one</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//field[@name='colleagues_ids']" position="attributes">-->
<!--                <attribute name="groups">base.group_no_one</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//field[@name='colleagues_ids']" position="after">-->
<!--                <field name="validator_id" groups="base.group_no_one"/>-->
<!--            </xpath>-->
            <!--
                Change the label of the default first page to 'Overall Rating' instead of 'Final Evaluation'
            -->
            <xpath expr="//notebook//page[1]" position="attributes">
                <attribute name="string">Overall Rating</attribute>
            </xpath>

            <!--
                Add new page at the beginning of the Notebook that shows the appraisal lines (appraisal_line_ids field)
                Add another page at the beginning of the Notebook that shows the objectives
            -->
            <xpath expr="//notebook//page[1]" position="before">
                <page string="Rating" name="smartest_rating" states="pending,done">
                    <field name="appraisal_line_ids"
                           context="{'form_view_ref': 'smartest_hr_appraisal.view_hr_appraisal_line_form'}">
                        <tree string="Appraisal Line" decoration-danger="comment_count != 0"
                              editable="bottom" default_group_by="stage_id">
                            <field name="appraisal_employee_id" string="Evaluated by" readonly="1" force_save="1"
                                   attrs="{'column_invisible': [('parent.show_appraisal_employee', '=', False)]}"/>
                            <field name="factor_category_id"/>
                            <field name="factor_description" invisible="1"/>
                            <field name="factor_id"/>
                            <widget name="factor_description_widget" width="0.1"/>
                            <field name="score" sum="Total Score"/>
                            <field name="level_id" optional="show"/>
                            <field name="employee_id" invisible="1"/>
                            <field name="comment_count" invisible="1"/>
                            <button name="do_comment" string="Add comment"
                                    attrs="{'invisible': [('parent.state', 'in', ('cancel'))]}"
                                    type="object"
                                    icon="fa-comment text-info"/>
                        </tree>
                    </field>
                    <group cols="4" invisible="1" name="technical_fields">
                        <field name="current_user_id"/>
                        <field name="show_appraisal_employee"/>
                    </group>
                </page>

                <page string="Objectives" name="smartest_objectives" states="pending,done">
                    <field name="objective_rating_ids">
                        <tree string="Objectives Rating" editable="bottom">
                            <field name="appraisal_employee_id" string="Evaluated by" readonly="1" force_save="1"
                                   attrs="{'column_invisible': [('parent.show_appraisal_employee', '=', False)]}"/>
                            <field name="objective_id" domain="['|', ('employee_ids', 'child_of', [parent.employee_id]), ('employee_ids', '=', False)]"/>
                            <field name="objective_type_id" optional="show"/>
                            <field name="rating"/>
                            <field name="objective_score" optional="hide"/>
                            <button name="do_comment" string="Add comment"
                                    attrs="{'invisible': [('parent.state', 'in', ('done', 'cancel'))]}"
                                    type="object"
                                    icon="fa-comment text-info"/>
                            <field name="progress" widget="progressbar" optional="show"/>
                            <field name="employee_id" invisible="1"/>
                        </tree>
                        <form>
                            <group string="Employee Comments">
                                <field name="employee_comment" nolabel="1" readonly="1"/>
                            </group>
                            <group string="Appraisal Employee Comments">
                                <field name="appraisal_employee_comment" nolabel="1" readonly="1"/>
                            </group>
                        </form>
                    </field>
                </page>
            </xpath>

            <!--
                Add comments page
            -->
            <xpath expr="//notebook//page[last()]" position="before">
                <page string="Comments" name="smartest_comments">
                    <group string="Evaluator responsible Comment">
                        <field name="evaluator_responsible_comment" nolabel="1" placeholder="Some comments..."/>
                    </group>
                    <group string="Evaluator Comment">
                        <field name="evaluator_comment" nolabel="1" placeholder="Some comments..."/>
                    </group>
                    <group string="Employee Comment">
                        <field name="employee_comment" nolabel="1" placeholder="Some comments..."/>
                    </group>
                </page>
            </xpath>

            <!--
                Add Overall rating field before the core field 'action_plan'
            -->
            <field name="manager_feedback" position="before">
                <group>
                    <group>
                        <field name="total_score"/>
                    </group>
                    <group>
                        <field name="overall_rating" widget="radio" options="{'horizontal': true}"/>
                    </group>
                </group>
            </field>

            <field name="manager_ids" position="attributes">
                <attribute name="context">{'smartest_bypass': True}</attribute>
                <attribute name="invisible">1</attribute>
            </field>

<!--            <field name="collaborators_ids" position="attributes">-->
<!--                <attribute name="context">{'smartest_bypass': True}</attribute>-->
<!--                <attribute name="invisible">1</attribute>-->
<!--            </field>-->

<!--            <field name="colleagues_ids" position="attributes">-->
<!--                <attribute name="context">{'smartest_bypass': True}</attribute>-->
<!--                <attribute name="invisible">1</attribute>-->
<!--            </field>-->
        </field>
    </record>

<!--    <template id="hr_appraisal_line_view_factor_details" inherit_id="web.assets_backend">-->
<!--        <xpath expr="." position="before">-->
<!--            <script type="text/javascript" src="/smartest_hr_appraisal/static/src/js/factor_description_widget.js"/>-->
<!--        </xpath>-->
<!--    </template>-->

</odoo>
